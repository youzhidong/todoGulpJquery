!function(){function t(t){task_list.push(t),store.set("task",task_list)}function e(){h.html(null);for(var t=[],e=0;e<task_list.length;e++)if(task_list[e].complate)t[e]=task_list[e];else{var a=i(e,task_list[e]);h.append(a)}for(var s=0;s<t.length;s++){var c=i(s,t[s]);h.append(c),c&&c.addClass("unline")}n($(".delete.r-main")),l(),u()}function i(t,e){if(e){var i='<li data-index="'+t+'"><input type="checkbox" '+(e.complate?"checked":"")+' class="complate"><p class="content">'+e.content+'</p><div class="right"><span class="delete r-main">删除</span><span class="deteal r-main">详细</span></div></li>';return $(i)}}function n(t){t.on("click",function(){a($(this).parent().parent().data("index"))})}function a(t){$(".Alert").show(),$(".primary.confirm").bind("click",function(){task_list.splice(t,1),$(".Alert").hide(),s(),e()}),$(".cancel").click(function(){$(".Alert").hide()})}function s(){store.set("task",task_list)}function l(){$(".deteal.r-main").on("click",function(){var t=$(this).parent().parent().data("index"),e=c(task_list[t]);h.after(e),d(t),o(),k(),$(".task-detail-mask,.colse").click(function(){$(".task-detail").remove(),$(this).remove()})})}function c(t){var e='<div class="task-detail-mask"></div><div class="task-detail"><form class="up-task"><h2 class="content">'+t.content+'</h2><div class="input-item"><input type="text" id="dbText"></div><div class="input-item"><textarea>'+(t.dsk||"")+'</textarea></div><div class="remind input-item"><label for="b">提醒时间</label><input id="b" class="datetime"  type="text" value="'+(t.time||"")+'"></div><div class="input-item"><button>更新</button></div><div class="colse">X</div></form></div>';return $(e)}function o(){$(".task-detail .up-task .content").dblclick(function(){var t=$("#dbText"),e=$(this);e.hide(),t.show(),t.focus(),t.blur(function(){t.hide(),e.show(),t.val()&&e.text(t.val())})})}function d(t){var e=$(".task-detail .up-task");e.on("submit",function(i){i.preventDefault();var n={};n.content=e.find(".content").text(),n.dsk=e.find(".input-item textarea").val(),n.time=e.find(".remind .datetime").val(),r(n,t),f()})}function r(t,i){task_list[i]=$.extend({},task_list[i],t),store.set("task",task_list),e()}function u(){$(".task-list .complate").on("click",function(){var t=$(this).parent().data("index");task_list[t].complate?r({complate:!1},t):r({complate:!0},t)})}function k(){$.datetimepicker.setLocale("ch"),$(".datetime").datetimepicker({yearStart:2016,yearEnd:2018})}function f(){var t=null;t=setInterval(function(){for(var e=(new Date).getTime(),i=0;i<task_list.length;i++)!task_list[i].time||task_list[i].complate||task_list[i].off||new Date(task_list[i].time).getTime()-e<1&&(console.log(1),p(task_list[i].content),r({off:!0},i),clearInterval(t),m())},1e3)}function m(){document.querySelector("#music").play()}function p(t){$(".msg").show(),$(".msg-content").text(t),$(".msg-btn").click(function(){$(".msg").hide()}),f()}var v=$(".add-task"),h=$(".task-list");task_list=[],function(){task_list=store.get("task")||[],e()}(),v.on("submit",function(i){i.preventDefault();var n={};n.content=v.find(".text").val(),n.content&&(t(n),e(),v.find(".text").val(null))}),f()}();